{"ast":null,"code":"import React,{useEffect,useState,useContext}from'react';import{AuthContext}from'../contexts/AuthContext';import{getStores,submitRating,updateRating}from'../services/storeService';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const StoreList=()=>{const{user}=useContext(AuthContext);const[stores,setStores]=useState([]);const[searchTerm,setSearchTerm]=useState('');const[ratings,setRatings]=useState({});const[userRatings,setUserRatings]=useState({});useEffect(()=>{const fetchStores=async()=>{try{const response=await getStores(user.token);setStores(response);const submittedRatings={};response.forEach(store=>{if(store.userRating){submittedRatings[store.id]=store.userRating;}});setRatings(submittedRatings);setUserRatings(submittedRatings);}catch(err){console.error('Failed to fetch stores:',err);}};fetchStores();},[user]);const handleRatingChange=(storeId,value)=>{setRatings(prev=>({...prev,[storeId]:value}));};const handleRatingSubmit=async storeId=>{const ratingValue=parseInt(ratings[storeId],10);if(!ratingValue||ratingValue<1||ratingValue>5){return alert('Please enter a valid rating between 1 and 5');}try{if(userRatings[storeId]){await updateRating(storeId,ratingValue,user.token);alert('Rating updated!');}else{await submitRating(storeId,ratingValue,user.token);alert('Rating submitted!');}// Refresh data\nconst updatedStores=await getStores(user.token);setStores(updatedStores);const updatedUserRatings={};updatedStores.forEach(store=>{if(store.userRating){updatedUserRatings[store.id]=store.userRating;}});setUserRatings(updatedUserRatings);setRatings(updatedUserRatings);}catch(err){console.error('Rating operation failed:',err);alert('Failed to submit/update rating');}};const filteredStores=stores.filter(store=>store.name.toLowerCase().includes(searchTerm.toLowerCase())||store.address.toLowerCase().includes(searchTerm.toLowerCase()));return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-4xl mx-auto p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-6\",children:\"\\uD83D\\uDECD\\uFE0F Store Listings\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search by Name or Address\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),className:\"border border-gray-300 rounded px-4 py-2 w-full mb-6\"}),filteredStores.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"No stores found.\"}):filteredStores.map(store=>{var _store$avgRating;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white shadow-sm border rounded p-5 mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold\",children:store.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600\",children:[\"\\uD83D\\uDCCD \",store.address]}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-1 text-sm\",children:[\"\\u2B50 Average Rating: \",((_store$avgRating=store.avgRating)===null||_store$avgRating===void 0?void 0:_store$avgRating.toFixed(1))||'No ratings yet']}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-green-700 mb-2\",children:[\"Your Rating: \",userRatings[store.id]||'Not rated yet']}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"1\",max:\"5\",value:ratings[store.id]||'',onChange:e=>handleRatingChange(store.id,e.target.value),className:\"border border-gray-300 px-3 py-1 rounded w-24\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleRatingSubmit(store.id),className:\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-1 rounded\",children:userRatings[store.id]?'Update Rating':'Submit Rating'})]})]},store.id);})]});};export default StoreList;","map":{"version":3,"names":["React","useEffect","useState","useContext","AuthContext","getStores","submitRating","updateRating","jsx","_jsx","jsxs","_jsxs","StoreList","user","stores","setStores","searchTerm","setSearchTerm","ratings","setRatings","userRatings","setUserRatings","fetchStores","response","token","submittedRatings","forEach","store","userRating","id","err","console","error","handleRatingChange","storeId","value","prev","handleRatingSubmit","ratingValue","parseInt","alert","updatedStores","updatedUserRatings","filteredStores","filter","name","toLowerCase","includes","address","className","children","type","placeholder","onChange","e","target","length","map","_store$avgRating","avgRating","toFixed","min","max","onClick"],"sources":["C:/Users/91630/store-rating-app/frontend/src/pages/StoreList.jsx"],"sourcesContent":["import React, { useEffect, useState, useContext } from 'react';\r\nimport { AuthContext } from '../contexts/AuthContext';\r\nimport { getStores, submitRating, updateRating } from '../services/storeService';\r\n\r\nconst StoreList = () => {\r\n  const { user } = useContext(AuthContext);\r\n  const [stores, setStores] = useState([]);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [ratings, setRatings] = useState({});\r\n  const [userRatings, setUserRatings] = useState({});\r\n\r\n  useEffect(() => {\r\n    const fetchStores = async () => {\r\n      try {\r\n        const response = await getStores(user.token);\r\n        setStores(response);\r\n\r\n        const submittedRatings = {};\r\n        response.forEach(store => {\r\n          if (store.userRating) {\r\n            submittedRatings[store.id] = store.userRating;\r\n          }\r\n        });\r\n\r\n        setRatings(submittedRatings);\r\n        setUserRatings(submittedRatings);\r\n      } catch (err) {\r\n        console.error('Failed to fetch stores:', err);\r\n      }\r\n    };\r\n    fetchStores();\r\n  }, [user]);\r\n\r\n  const handleRatingChange = (storeId, value) => {\r\n    setRatings(prev => ({ ...prev, [storeId]: value }));\r\n  };\r\n\r\n  const handleRatingSubmit = async (storeId) => {\r\n    const ratingValue = parseInt(ratings[storeId], 10);\r\n    if (!ratingValue || ratingValue < 1 || ratingValue > 5) {\r\n      return alert('Please enter a valid rating between 1 and 5');\r\n    }\r\n\r\n    try {\r\n      if (userRatings[storeId]) {\r\n        await updateRating(storeId, ratingValue, user.token);\r\n        alert('Rating updated!');\r\n      } else {\r\n        await submitRating(storeId, ratingValue, user.token);\r\n        alert('Rating submitted!');\r\n      }\r\n\r\n      // Refresh data\r\n      const updatedStores = await getStores(user.token);\r\n      setStores(updatedStores);\r\n\r\n      const updatedUserRatings = {};\r\n      updatedStores.forEach(store => {\r\n        if (store.userRating) {\r\n          updatedUserRatings[store.id] = store.userRating;\r\n        }\r\n      });\r\n      setUserRatings(updatedUserRatings);\r\n      setRatings(updatedUserRatings);\r\n    } catch (err) {\r\n      console.error('Rating operation failed:', err);\r\n      alert('Failed to submit/update rating');\r\n    }\r\n  };\r\n\r\n  const filteredStores = stores.filter(store =>\r\n    store.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n    store.address.toLowerCase().includes(searchTerm.toLowerCase())\r\n  );\r\n\r\n  return (\r\n    <div className=\"max-w-4xl mx-auto p-6\">\r\n      <h2 className=\"text-2xl font-bold mb-6\">üõçÔ∏è Store Listings</h2>\r\n\r\n      <input\r\n        type=\"text\"\r\n        placeholder=\"Search by Name or Address\"\r\n        value={searchTerm}\r\n        onChange={(e) => setSearchTerm(e.target.value)}\r\n        className=\"border border-gray-300 rounded px-4 py-2 w-full mb-6\"\r\n      />\r\n\r\n      {filteredStores.length === 0 ? (\r\n        <p className=\"text-gray-500\">No stores found.</p>\r\n      ) : (\r\n        filteredStores.map((store) => (\r\n          <div\r\n            key={store.id}\r\n            className=\"bg-white shadow-sm border rounded p-5 mb-4\"\r\n          >\r\n            <h3 className=\"text-lg font-semibold\">{store.name}</h3>\r\n            <p className=\"text-gray-600\">üìç {store.address}</p>\r\n            <p className=\"mt-1 text-sm\">‚≠ê Average Rating: {store.avgRating?.toFixed(1) || 'No ratings yet'}</p>\r\n            <p className=\"text-sm text-green-700 mb-2\">\r\n              Your Rating: {userRatings[store.id] || 'Not rated yet'}\r\n            </p>\r\n\r\n            <div className=\"flex items-center gap-2\">\r\n              <input\r\n                type=\"number\"\r\n                min=\"1\"\r\n                max=\"5\"\r\n                value={ratings[store.id] || ''}\r\n                onChange={(e) => handleRatingChange(store.id, e.target.value)}\r\n                className=\"border border-gray-300 px-3 py-1 rounded w-24\"\r\n              />\r\n              <button\r\n                onClick={() => handleRatingSubmit(store.id)}\r\n                className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-1 rounded\"\r\n              >\r\n                {userRatings[store.id] ? 'Update Rating' : 'Submit Rating'}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        ))\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StoreList;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}